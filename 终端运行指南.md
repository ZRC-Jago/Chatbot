# 终端运行项目指南

本文档详细说明如何在终端中运行这个 Next.js 项目。

## 📋 前置要求

1. **Node.js** (版本 18 或更高)
   - 检查版本：`node --version`
   - 下载地址：https://nodejs.org/

2. **包管理器**（三选一）
   - **pnpm**（推荐，项目使用 pnpm-lock.yaml）
   - npm（Node.js 自带）
   - yarn

## 🚀 快速开始

### 步骤 1：打开终端

**Windows:**
- 按 `Win + R`，输入 `cmd` 或 `powershell`，回车
- 或者在项目文件夹中，按住 `Shift` 右键，选择"在此处打开 PowerShell 窗口"

**Mac/Linux:**
- 打开 Terminal（终端）
- 使用 `cd` 命令进入项目目录

### 步骤 2：进入项目目录

```bash
cd E:\A_Desktop\my_test
```

### 步骤 3：安装依赖

**使用 pnpm（推荐）：**
```bash
# 如果没有安装 pnpm，先安装
npm install -g pnpm

# 安装项目依赖
pnpm install
```

**使用 npm：**
```bash
npm install
```

**使用 yarn：**
```bash
yarn install
```

### 步骤 4：配置环境变量

在项目根目录创建 `.env.local` 文件：

```bash
# Windows PowerShell
New-Item -Path .env.local -ItemType File

# Windows CMD
type nul > .env.local

# Mac/Linux
touch .env.local
```

然后编辑 `.env.local` 文件，添加以下环境变量：

```env
# Supabase 配置（必需）
NEXT_PUBLIC_SUPABASE_URL=你的_Supabase_项目_URL
NEXT_PUBLIC_SUPABASE_ANON_KEY=你的_Supabase_Anon_Key

# SiliconFlow API（必需，用于 AI 聊天和语音）
SILICONFLOW_API_KEY=你的_SiliconFlow_API_密钥

# Creem 支付配置（可选，如果不需要支付功能可以不配置）
CREEM_API_KEY=你的_Creem_API_密钥
SUCCESS_URL=http://localhost:3000/account

# 如果使用 ngrok（可选）
# NGROK_URL=https://xxxx.ngrok.io
```

**获取环境变量：**
- **Supabase**: https://supabase.com/dashboard/project/_/settings/api
- **SiliconFlow**: https://siliconflow.cn/ （注册账号后获取 API Key）
- **Creem**: https://creem.com/ （注册账号后获取 API Key）

### 步骤 5：运行开发服务器

**使用 pnpm：**
```bash
pnpm dev
```

**使用 npm：**
```bash
npm run dev
```

**使用 yarn：**
```bash
yarn dev
```

### 步骤 6：打开浏览器

看到以下输出表示启动成功：
```
  ▲ Next.js 16.0.10
  - Local:        http://localhost:3000
  - Ready in 2.3s
```

在浏览器中打开：**http://localhost:3000**

---

## 📝 常用命令

### 开发模式
```bash
# 启动开发服务器（支持热重载）
pnpm dev
# 或
npm run dev
```

### 生产模式
```bash
# 1. 构建生产版本
pnpm build
# 或
npm run build

# 2. 启动生产服务器
pnpm start
# 或
npm start
```

### 代码检查
```bash
# 运行 ESLint
pnpm lint
# 或
npm run lint
```

---

## 🔧 常见问题

### 问题 1：端口 3000 已被占用

**解决方案：**
```bash
# 使用其他端口（例如 3001）
pnpm dev -- -p 3001
# 或
PORT=3001 pnpm dev
```

### 问题 2：依赖安装失败

**解决方案：**
```bash
# 清除缓存后重新安装
pnpm store prune
rm -rf node_modules
pnpm install

# 或使用 npm
rm -rf node_modules package-lock.json
npm install
```

### 问题 3：环境变量未生效

**检查：**
1. `.env.local` 文件是否在项目根目录
2. 环境变量名称是否正确（注意大小写）
3. 重启开发服务器（修改环境变量后需要重启）

### 问题 4：Supabase 连接错误

**检查：**
1. `NEXT_PUBLIC_SUPABASE_URL` 是否正确
2. `NEXT_PUBLIC_SUPABASE_ANON_KEY` 是否正确
3. Supabase 项目是否正常运行
4. 网络连接是否正常

### 问题 5：AI 聊天功能不工作

**检查：**
1. `SILICONFLOW_API_KEY` 是否配置
2. API Key 是否有效
3. 查看终端错误日志

---

## 🛠️ 完整启动流程（Windows PowerShell）

```powershell
# 1. 进入项目目录
cd E:\A_Desktop\my_test

# 2. 检查 Node.js 版本
node --version

# 3. 安装 pnpm（如果还没有）
npm install -g pnpm

# 4. 安装依赖
pnpm install

# 5. 创建环境变量文件（如果还没有）
if (!(Test-Path .env.local)) {
    New-Item -Path .env.local -ItemType File
    Write-Host "已创建 .env.local 文件，请编辑并添加环境变量"
}

# 6. 启动开发服务器
pnpm dev
```

---

## 🛠️ 完整启动流程（Mac/Linux）

```bash
# 1. 进入项目目录
cd ~/path/to/my_test

# 2. 检查 Node.js 版本
node --version

# 3. 安装 pnpm（如果还没有）
npm install -g pnpm

# 4. 安装依赖
pnpm install

# 5. 创建环境变量文件（如果还没有）
if [ ! -f .env.local ]; then
    touch .env.local
    echo "已创建 .env.local 文件，请编辑并添加环境变量"
fi

# 6. 启动开发服务器
pnpm dev
```

---

## 📦 项目结构说明

```
my_test/
├── app/                 # Next.js App Router 页面和 API
│   ├── api/            # API 路由
│   │   ├── chat/       # 聊天 API
│   │   ├── chat-room/  # 聊天室 API
│   │   ├── tts/        # 文本转语音 API
│   │   ├── checkout/   # 支付 API
│   │   └── webhook/    # 支付回调 API
│   ├── page.tsx        # 首页（聊天界面）
│   └── account/        # 账户页面
├── components/         # React 组件
├── lib/               # 工具函数和配置
├── .env.local        # 环境变量（需要自己创建）
├── package.json      # 项目配置和依赖
└── next.config.mjs   # Next.js 配置
```

---

## 🎯 下一步

1. ✅ 项目启动成功后，访问 http://localhost:3000
2. ✅ 测试登录功能（需要 Supabase 配置）
3. ✅ 测试聊天功能（需要 SiliconFlow API Key）
4. ✅ 查看 API 调用文档：`API_CALL_GUIDE.md`

---

## 💡 提示

- **开发模式**：修改代码后会自动刷新，无需重启
- **生产模式**：需要先 `build` 再 `start`，性能更好但不支持热重载
- **环境变量**：`.env.local` 文件不会被提交到 Git，可以安全存储密钥
- **端口**：默认使用 3000 端口，可以在 `package.json` 中修改

---

## 📚 相关文档

- [API 调用指南](./API_CALL_GUIDE.md) - 详细的 API 使用说明
- [Ngrok 使用指南](./NGROK_GUIDE.md) - 如何配置公网访问
- [Supabase 文档](https://supabase.com/docs) - 数据库和认证服务

---

## 🆘 需要帮助？

如果遇到问题：
1. 查看终端错误信息
2. 检查环境变量配置
3. 确认所有依赖已正确安装
4. 查看浏览器控制台错误信息
